
<h2>Student Management</h2>
<div class="student-list-container">
    <div class="header">
    <!--Search Filters -->
    <div class="search-area">
      <input type="text" placeholder="Search by name"   [(ngModel)]="filters.name">

      <input type="email" placeholder="Search by email" [(ngModel)]="filters.email">

      <input type="date" placeholder="Search by DOB" [(ngModel)]="filters.dob">

      <input type="text" placeholder="Search by branch" [(ngModel)]="filters.branch">
     <button (click)="onSearch()" class="btn btn-primary">Search</button> <button (click)="onReset()" class="btn btn-secondary">Reset</button>
    
    <div class="header-actions">
      <a *ngIf="canManageStudents" routerLink="/items" class="btn btn-primary">Add New Student</a>
      <button (click)="loadStudents()" class="btn btn-secondary">Refresh</button>
      <a *ngIf="canManageStudents" routerLink="/student-performance" class="btn btn-analytics">
        Performance Graph
      </a>
      <div class="items-per-page">
        <label for="itemsPerPage">Rows per page</label>
        <select id="itemsPerPage" [ngModel]="itemsPerPage" (ngModelChange)="onItemsPerPageChange($event)">
          <option *ngFor="let option of itemsPerPageOptions" [value]="option">
            {{ option }}
          </option>
        </select>
      </div>
    </div>

    <div class="bulk-upload" *ngIf="canManageStudents">
      <label class="btn btn-secondary">
        Upload CSV
        <input type="file" accept=".csv" (change)="onFileSelected($event)" style="display:none">
      </label>
      <span *ngIf="bulkUploading">Uploading...</span>
      <div class="bulk-message" *ngIf="bulkMessage">{{ bulkMessage }}</div>
    </div>
  </div>
        </div>
  <!-- Loading State -->
  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading students...</p>
  </div>

  <!-- Error State -->
  <div class="error" *ngIf="errorMessage">
    <p>{{ errorMessage }}</p>
    <button (click)="loadStudents()" class="btn btn-secondary">Retry</button>
  </div>

  <!-- Students Table -->
  <div class="students-table" *ngIf="!isLoading && !errorMessage">
    <div class="table-header">
      <h3>All Students ({{ filteredStudents.length }})</h3>
    </div>

    <div class="table-container" *ngIf="filteredStudents.length > 0">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Branch</th>
            <th>Courses</th>
            <th>Date of Birth</th>
            <th>Age</th>
            <th *ngIf="canManageStudents || canViewMarksCard">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Only show paginated records -->
          <tr *ngFor="let student of paginatedStudents">
            <td>{{ student.id }}</td>
            <td>{{ student.name }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.branch }}</td>
            <td>
              <span *ngIf="student.courseNames && student.courseNames.length > 0; else noCourses">
                {{ student.courseNames.join(', ') }}
              </span>
              <ng-template #noCourses>
                <span class="no-data">No courses enrolled</span>
              </ng-template>
            </td>
            <td>{{ formatDate(student.dob) }}</td>
            <td>{{ calculateAge(student.dob) }}</td>
            <td class="actions" *ngIf="canManageStudents || canViewMarksCard">
              <ng-container *ngIf="canManageStudents">
                <a [routerLink]="['/edit-student', student.id]" class="btn btn-edit">Edit</a>
                <a [routerLink]="['/student-enroll', student.id]" class="btn btn-enroll">Enroll</a>
                <a [routerLink]="['/edit-student', student.id]" class="btn btn-grade">Enter Grades</a>
                <button
                  *ngIf="canDeleteStudents"
                  (click)="deleteStudent(student.id!)"
                  class="btn btn-delete">
                  Delete
                </button>
              </ng-container>
              <a [routerLink]="['/marks-card', student.id]" class="btn btn-card">Marks Card</a>
            </td>
          </tr>
        </tbody>
      </table>

       <!-- Pagination Controls -->
      <div class="pagination" *ngIf="filteredStudents.length > 0">
        <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>

        <button
          *ngFor="let page of pageButtons"
          (click)="goToPage(page)"
          [class.active]="currentPage === page">
          {{ page }}
        </button>

        <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>

        <span class="page-info">
          Page {{ currentPage }} of {{ totalPages }}
        </span>
      </div>
    </div>
<!-- empty state -->
    <div class="empty-state" *ngIf="filteredStudents.length === 0">
      <div class="empty-icon"></div>
      <h3>No Such Students Found</h3>
      <a *ngIf="canManageStudents" routerLink="/items" class="btn btn-primary">Add The Student to List</a>
    </div>
  </div>
</div>
